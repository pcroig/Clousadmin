generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accounts {
  id                String   @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  usuarios          usuarios @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model alertas_nomina {
  id              String     @id
  empresaId       String
  nominaId        String?
  tipo            String     @db.VarChar(50)
  mensaje         String
  resuelta        Boolean    @default(false)
  fechaResolucion DateTime?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  accionUrl       String?
  categoria       String     @db.VarChar(100)
  codigo          String     @db.VarChar(100)
  detalles        Json?
  empleadoId      String?
  empleados       empleados? @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas        empresas   @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  nominas         nominas?   @relation(fields: [nominaId], references: [id], onDelete: Cascade)

  @@index([categoria])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([nominaId])
  @@index([resuelta])
  @@index([tipo])
}

model asignaciones_complemento {
  id                    String                @id
  nominaId              String
  empleadoComplementoId String
  importe               Decimal               @db.Decimal(10, 2)
  asignadoPor           String?
  fechaAsignacion       DateTime              @default(now())
  notas                 String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  empleado_complementos empleado_complementos @relation(fields: [empleadoComplementoId], references: [id], onDelete: Cascade)
  nominas               nominas               @relation(fields: [nominaId], references: [id], onDelete: Cascade)

  @@unique([nominaId, empleadoComplementoId])
  @@index([empleadoComplementoId])
  @@index([nominaId])
}

model auditoria_accesos {
  id                 String   @id
  empresaId          String
  usuarioId          String
  empleadoAccedidoId String?
  accion             String   @db.VarChar(50)
  recurso            String   @db.VarChar(100)
  camposAccedidos    Json?
  ipAddress          String?  @db.VarChar(50)
  userAgent          String?
  motivo             String?
  createdAt          DateTime @default(now())
  empresas           empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  usuarios           usuarios @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([accion])
  @@index([createdAt])
  @@index([empleadoAccedidoId])
  @@index([empresaId])
  @@index([recurso])
  @@index([usuarioId])
}

model ausencias {
  id                         String                      @id
  empresaId                  String
  empleadoId                 String
  fechaInicio                DateTime                    @db.Date
  fechaFin                   DateTime                    @db.Date
  diasNaturales              Int
  diasLaborables             Int
  motivo                     String?
  estado                     EstadoAusencia              @default(pendiente)
  aprobadaPor                String?
  aprobadaEn                 DateTime?
  motivoRechazo              String?
  documentoId                String?
  optimizadaIA               Boolean                     @default(false)
  notasIA                    String?
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime
  descuentaSaldo             Boolean                     @default(false)
  diasAlternativos           Json?
  diasIdeales                Json?
  diasPrioritarios           Json?
  diasSolicitados            Decimal                     @db.Decimal(4, 1)
  equipoId                   String?
  justificanteUrl            String?
  medioDia                   Boolean                     @default(false)
  revisionIA                 Json?
  periodo                    PeriodoMedioDia?
  tipo                       TipoAusencia
  diasDesdeCarryOver         Decimal                     @default(0) @db.Decimal(4, 1)
  documentos                 documentos?                 @relation(fields: [documentoId], references: [id])
  empleados                  empleados                   @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas                   empresas                    @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  equipos                    equipos?                    @relation(fields: [equipoId], references: [id])
  compensaciones_horas_extra compensaciones_horas_extra?

  @@index([documentoId])
  @@index([empleadoId])
  @@index([empresaId, empleadoId, estado])
  @@index([empresaId, estado])
  @@index([empresaId])
  @@index([empresaId, tipo, estado])
  @@index([equipoId])
  @@index([estado])
  @@index([fechaInicio, fechaFin])
  @@index([tipo])
}

model auto_completados {
  id              String    @id
  empresaId       String
  empleadoId      String
  tipo            String    @db.VarChar(50)
  estado          String    @default("pendiente") @db.VarChar(50)
  expiraEn        DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  aprobadoEn      DateTime?
  aprobadoPor     String?
  datosOriginales Json
  sugerencias     Json
  empleados       empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas        empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empleadoId])
  @@index([empresaId, estado, expiraEn])
  @@index([empresaId])
  @@index([empresaId, tipo, estado])
  @@index([estado])
  @@index([expiraEn])
  @@index([tipo])
}

model billing_customers {
  id            String          @id
  empresaId     String          @unique
  email         String          @db.VarChar(255)
  nombre        String?         @db.VarChar(255)
  direccion     Json?
  taxId         String?         @db.VarChar(50)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  empresas      empresas        @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  subscriptions subscriptions[]

  @@index([empresaId])
}

model billing_prices {
  id               String           @id
  productoId       String
  unitAmount       Int
  currency         String           @default("eur") @db.VarChar(3)
  intervalo        BillingInterval  @default(month)
  intervalCount    Int              @default(1)
  trialDays        Int?
  activo           Boolean          @default(true)
  metadata         Json?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  billing_products billing_products @relation(fields: [productoId], references: [id], onDelete: Cascade)
  subscriptions    subscriptions[]

  @@index([activo])
  @@index([productoId])
}

model billing_products {
  id             String           @id
  nombre         String           @db.VarChar(255)
  descripcion    String?
  activo         Boolean          @default(true)
  imagen         String?
  features       Json             @default("[]")
  orden          Int              @default(0)
  metadata       Json?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  billing_prices billing_prices[]

  @@index([activo])
  @@index([orden])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model campanas_vacaciones {
  id                      String                    @id
  empresaId               String
  titulo                  String                    @db.VarChar(200)
  alcance                 String                    @default("todos") @db.VarChar(50)
  equipoIds               Json?
  estado                  String                    @default("abierta") @db.VarChar(50)
  solapamientoMaximoPct   Int?
  propuestaIA             Json?
  totalEmpleadosAsignados Int                       @default(0)
  empleadosCompletados    Int                       @default(0)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  cerradaEn               DateTime?
  cuadradaEn              DateTime?
  fechaFinObjetivo        DateTime                  @db.Date
  fechaInicioObjetivo     DateTime                  @db.Date
  finalizadaEn            DateTime?
  empresas                empresas                  @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  preferencias_vacaciones preferencias_vacaciones[]

  @@index([empresaId])
  @@index([estado])
}

model carpetas {
  id                    String       @id
  empresaId             String
  empleadoId            String?
  nombre                String       @db.VarChar(255)
  parentId              String?
  esSistema             Boolean      @default(false)
  createdAt             DateTime     @default(now())
  updatedAt             DateTime
  asignadoA             String?
  compartida            Boolean      @default(false)
  vinculadaAProceso     String?      @db.VarChar(50)
  requiereFirma         Boolean      @default(false)
  requiereRellenarDatos Boolean      @default(false)
  camposRequeridos      Json?
  empleados             empleados?   @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas              empresas     @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  carpetas              carpetas?    @relation("carpetasTocarpetas", fields: [parentId], references: [id], onDelete: Cascade)
  other_carpetas        carpetas[]   @relation("carpetasTocarpetas")
  documentos            documentos[]

  @@index([compartida])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([parentId])
  @@index([vinculadaAProceso])
}

model compensaciones_horas_extra {
  id               String     @id
  empresaId        String
  empleadoId       String
  horasBalance     Decimal    @db.Decimal(5, 2)
  tipoCompensacion String     @db.VarChar(50)
  estado           String     @default("pendiente") @db.VarChar(50)
  diasAusencia     Decimal?   @db.Decimal(4, 1)
  ausenciaId       String?    @unique
  nominaId         String?
  aprobadoPor      String?
  aprobadoEn       DateTime?
  motivoRechazo    String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime
  ausencias        ausencias? @relation(fields: [ausenciaId], references: [id])
  empleados        empleados  @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas         empresas   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empleadoId])
  @@index([empresaId])
  @@index([estado])
}

model consentimientos {
  id          String    @id
  empresaId   String
  empleadoId  String
  tipo        String    @db.VarChar(100)
  descripcion String
  otorgado    Boolean   @default(false)
  otorgadoEn  DateTime?
  revocadoEn  DateTime?
  version     String    @db.VarChar(50)
  ipAddress   String?   @db.VarChar(50)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  empleados   empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas    empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, empleadoId, tipo])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([otorgado])
  @@index([tipo])
}

model contratos {
  id                    String                  @id
  empleadoId            String
  fechaInicio           DateTime                @db.Date
  fechaFin              DateTime?               @db.Date
  salarioBaseAnual      Decimal                 @db.Decimal(10, 2)
  documentoId           String?                 @unique
  datosExtraidosIA      Json?
  verificado            Boolean                 @default(false)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  tipoContrato          TipoContrato
  empleados             empleados               @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empleado_complementos empleado_complementos[]
  nominas               nominas[]

  @@index([empleadoId])
  @@index([tipoContrato])
}

model denuncias {
  id            String     @id
  empresaId     String
  denuncianteId String?
  descripcion   String
  esAnonima     Boolean    @default(false)
  documentos    Json?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime
  empleados     empleados? @relation(fields: [denuncianteId], references: [id])
  empresas      empresas   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([denuncianteId])
  @@index([empresaId])
}

model documentos {
  id                     String                @id
  empresaId              String
  empleadoId             String?
  carpetaId              String?
  nombre                 String                @db.VarChar(255)
  tipoDocumento          String                @db.VarChar(100)
  mimeType               String                @db.VarChar(100)
  tamano                 Int
  s3Key                  String                @unique
  s3Bucket               String                @db.VarChar(255)
  procesadoIA            Boolean               @default(false)
  datosExtraidos         Json?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime
  puestoId               String?
  requiereFirma          Boolean               @default(false)
  firmado                Boolean               @default(false)
  firmadoEn              DateTime?
  hashDocumento          String?
  generadoDesdePlantilla Boolean               @default(false)
  ausencias              ausencias[]
  carpetas               carpetas?             @relation(fields: [carpetaId], references: [id])
  empleados              empleados?            @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas               empresas              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  puestos                puestos?              @relation(fields: [puestoId], references: [id], onDelete: Cascade)
  documentos_generados   documentos_generados?
  nominas                nominas?
  solicitudes_firma      solicitudes_firma[]

  @@index([carpetaId])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([generadoDesdePlantilla])
  @@index([puestoId])
  @@index([requiereFirma, firmado])
  @@index([s3Key])
  @@index([tipoDocumento])
}

model documentos_generados {
  id                    String                @id
  empresaId             String
  empleadoId            String
  plantillaId           String
  documentoId           String                @unique
  generadoPor           String?
  generadoEn            DateTime              @default(now())
  variablesUtilizadas   Json
  usadaIA               Boolean               @default(false)
  confianzaIA           Decimal?              @db.Decimal(3, 2)
  tiempoGeneracion      Int?
  notificado            Boolean               @default(false)
  visto                 Boolean               @default(false)
  vistoEn               DateTime?
  requiereFirma         Boolean               @default(false)
  firmado               Boolean               @default(false)
  firmadoEn             DateTime?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  camposCompletados     Json?
  pendienteRellenar     Boolean               @default(false)
  rellenadoEn           DateTime?
  documentos            documentos            @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  empleados             empleados             @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas              empresas              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  plantillas_documentos plantillas_documentos @relation(fields: [plantillaId], references: [id], onDelete: Cascade)

  @@index([documentoId])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([firmado])
  @@index([generadoEn])
  @@index([plantillaId])
  @@index([usadaIA])
}

model empleado_complementos {
  id                       String                     @id
  empleadoId               String
  tipoComplementoId        String
  contratoId               String?
  importePersonalizado     Decimal?                   @db.Decimal(10, 2)
  activo                   Boolean                    @default(true)
  validado                 Boolean                    @default(false)
  validadoPor              String?
  fechaValidacion          DateTime?
  rechazado                Boolean                    @default(false)
  motivoRechazo            String?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  asignaciones_complemento asignaciones_complemento[]
  contratos                contratos?                 @relation(fields: [contratoId], references: [id])
  empleados                empleados                  @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  tipos_complemento        tipos_complemento          @relation(fields: [tipoComplementoId], references: [id], onDelete: Cascade)

  @@index([contratoId])
  @@index([empleadoId, activo])
  @@index([tipoComplementoId])
}

model empleado_equipos {
  empleadoId         String
  equipoId           String
  fechaIncorporacion DateTime  @default(now())
  empleados          empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  equipos            equipos   @relation(fields: [equipoId], references: [id], onDelete: Cascade)

  @@id([empleadoId, equipoId])
  @@index([empleadoId])
  @@index([equipoId])
}

model empleado_saldo_ausencias {
  id                  String    @id
  empleadoId          String
  empresaId           String
  a_o                 Int       @map("a√±o") @db.SmallInt
  diasTotales         Int       @default(0)
  diasUsados          Decimal   @default(0) @db.Decimal(4, 1)
  diasPendientes      Decimal   @default(0) @db.Decimal(4, 1)
  origen              String    @db.VarChar(50)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  carryOverAsignado   Decimal   @default(0) @db.Decimal(4, 1)
  carryOverExpiraEn   DateTime?
  carryOverFuenteAnio Int?      @db.SmallInt
  carryOverPendiente  Decimal   @default(0) @db.Decimal(4, 1)
  carryOverUsado      Decimal   @default(0) @db.Decimal(4, 1)
  empleados           empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas            empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empleadoId, a_o])
  @@index([empleadoId, a_o])
  @@index([empresaId])
}

model empleados {
  id                                                                                   String                           @id
  empresaId                                                                            String
  usuarioId                                                                            String                           @unique
  nombre                                                                               String                           @db.VarChar(100)
  apellidos                                                                            String                           @db.VarChar(200)
  email                                                                                String                           @unique @db.VarChar(255)
  fotoUrl                                                                              String?
  nif                                                                                  String?                          @unique
  nss                                                                                  String?
  fechaNacimiento                                                                      DateTime?
  telefono                                                                             String?                          @db.VarChar(20)
  codigoPostal                                                                         String?                          @db.VarChar(5)
  ciudad                                                                               String?                          @db.VarChar(100)
  estadoCivil                                                                          String?                          @db.VarChar(50)
  numeroHijos                                                                          Int                              @default(0) @db.SmallInt
  genero                                                                               String?                          @db.VarChar(50)
  iban                                                                                 String?
  bic                                                                                  String?                          @db.VarChar(11)
  puesto                                                                               String?                          @db.VarChar(100)
  fechaAlta                                                                            DateTime
  fechaBaja                                                                            DateTime?
  categoriaProfesional                                                                 String?                          @db.VarChar(50)
  grupoCotizacion                                                                      Int?                             @db.SmallInt
  managerId                                                                            String?
  jornadaId                                                                            String?
  salarioBaseAnual                                                                     Decimal?                         @db.Decimal(10, 2)
  salarioBaseMensual                                                                   Decimal?                         @db.Decimal(10, 2)
  diasVacaciones                                                                       Int                              @default(22)
  onboardingCompletado                                                                 Boolean                          @default(false)
  onboardingCompletadoEn                                                               DateTime?
  documentosCompletos                                                                  Boolean                          @default(false)
  documentosCompletadosEn                                                              DateTime?
  activo                                                                               Boolean                          @default(true)
  createdAt                                                                            DateTime                         @default(now())
  updatedAt                                                                            DateTime
  puestoId                                                                             String?
  direccionCalle                                                                       String?                          @db.VarChar(200)
  direccionNumero                                                                      String?                          @db.VarChar(10)
  direccionPiso                                                                        String?                          @db.VarChar(100)
  direccionProvincia                                                                   String?                          @db.VarChar(100)
  firmaGuardada                                                                        Boolean                          @default(false)
  firmaS3Key                                                                           String?
  firmaGuardadaData                                                                    Json?
  nivelEducacion                                                                       String?                          @db.VarChar(50)
  tipoContrato                                                                         TipoContrato                     @default(indefinido)
  estadoEmpleado                                                                       EstadoEmpleado                   @default(activo)
  saldoRenovadoDesde                                                                   DateTime?
  alertas_nomina                                                                       alertas_nomina[]
  ausencias                                                                            ausencias[]
  auto_completados                                                                     auto_completados[]
  carpetas                                                                             carpetas[]
  compensaciones_horas_extra                                                           compensaciones_horas_extra[]
  consentimientos                                                                      consentimientos[]
  contratos                                                                            contratos[]
  denuncias                                                                            denuncias[]
  documentos                                                                           documentos[]
  documentos_generados                                                                 documentos_generados[]
  empleado_complementos                                                                empleado_complementos[]
  empleado_equipos                                                                     empleado_equipos[]
  empleado_saldo_ausencias                                                             empleado_saldo_ausencias[]
  empresas                                                                             empresas                         @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  jornadas                                                                             jornadas?                        @relation(fields: [jornadaId], references: [id])
  empleados                                                                            empleados?                       @relation("empleadosToempleados", fields: [managerId], references: [id])
  other_empleados                                                                      empleados[]                      @relation("empleadosToempleados")
  puestos                                                                              puestos?                         @relation(fields: [puestoId], references: [id])
  usuarios                                                                             usuarios                         @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  equipos                                                                              equipos[]
  fichajes                                                                             fichajes[]
  firmas                                                                               firmas[]
  invitaciones_empleados                                                               invitaciones_empleados?
  nominas                                                                              nominas[]
  onboarding_empleados                                                                 onboarding_empleados?
  preferencias_vacaciones                                                              preferencias_vacaciones[]
  resumenes_mensuales_nomina                                                           resumenes_mensuales_nomina[]
  solicitudes_cambio_solicitudes_cambio_aprobadorIdToempleados                         solicitudes_cambio[]             @relation("solicitudes_cambio_aprobadorIdToempleados")
  solicitudes_cambio_solicitudes_cambio_empleadoIdToempleados                          solicitudes_cambio[]             @relation("solicitudes_cambio_empleadoIdToempleados")
  solicitudes_correccion_fichaje_solicitudes_correccion_fichaje_empleadoIdToempleados  solicitudes_correccion_fichaje[] @relation("solicitudes_correccion_fichaje_empleadoIdToempleados")
  solicitudes_correccion_fichaje_solicitudes_correccion_fichaje_revisadaPorToempleados solicitudes_correccion_fichaje[] @relation("solicitudes_correccion_fichaje_revisadaPorToempleados")
  solicitudes_eliminacion_datos                                                        solicitudes_eliminacion_datos[]

  @@index([email])
  @@index([empresaId])
  @@index([estadoEmpleado])
  @@index([jornadaId])
  @@index([managerId])
  @@index([nif])
  @@index([puestoId])
  @@index([usuarioId])
}

model empresas {
  id                             String                           @id
  nombre                         String                           @db.VarChar(200)
  cif                            String?                          @unique @db.VarChar(20)
  email                          String?                          @db.VarChar(255)
  telefono                       String?                          @db.VarChar(20)
  direccion                      String?
  logoUrl                        String?
  config                         Json                             @default("{\"umbral_ia_nominas\": 0.8, \"umbral_ia_contratos\": 0.85, \"empleado_puede_ver_salario\": false, \"hora_cierre_fichaje_default\": \"18:00\", \"auto_completado_nominas_dias\": 7, \"auto_completado_fichajes_dias\": 7, \"auto_completado_contratos_dias\": 14, \"permitir_saldo_vacaciones_negativo\": true}")
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  web                            String?                          @db.VarChar(255)
  activo                         Boolean                          @default(true)
  alertas_nomina                 alertas_nomina[]
  auditoria_accesos              auditoria_accesos[]
  ausencias                      ausencias[]
  auto_completados               auto_completados[]
  billing_customers              billing_customers?
  campanas_vacaciones            campanas_vacaciones[]
  carpetas                       carpetas[]
  compensaciones_horas_extra     compensaciones_horas_extra[]
  consentimientos                consentimientos[]
  denuncias                      denuncias[]
  documentos                     documentos[]
  documentos_generados           documentos_generados[]
  empleado_saldo_ausencias       empleado_saldo_ausencias[]
  empleados                      empleados[]
  equipo_politica_ausencias      equipo_politica_ausencias[]
  equipos                        equipos[]
  eventos_nomina                 eventos_nomina[]
  exports_gestoria               exports_gestoria[]
  festivos                       festivos[]
  fichajes                       fichajes[]
  integraciones                  integraciones[]
  invitaciones_empleados         invitaciones_empleados[]
  jobs_generacion_documentos     jobs_generacion_documentos[]
  jornadas                       jornadas[]
  notificaciones                 notificaciones[]
  onboarding_configs             onboarding_configs?
  onboarding_empleados           onboarding_empleados[]
  plantillas_documentos          plantillas_documentos[]
  preferencias_vacaciones        preferencias_vacaciones[]
  puestos                        puestos[]
  resumenes_mensuales_nomina     resumenes_mensuales_nomina[]
  sedes                          sedes[]
  solicitudes_cambio             solicitudes_cambio[]
  solicitudes_correccion_fichaje solicitudes_correccion_fichaje[]
  solicitudes_eliminacion_datos  solicitudes_eliminacion_datos[]
  solicitudes_firma              solicitudes_firma[]
  subscriptions                  subscriptions[]
  tipos_complemento              tipos_complemento[]
  usuarios                       usuarios[]

  @@index([cif])
}

model equipo_politica_ausencias {
  equipoId               String   @id
  empresaId              String
  maxSolapamientoPct     Int      @default(50)
  requiereAntelacionDias Int      @default(5)
  createdAt              DateTime @default(now())
  updatedAt              DateTime
  empresas               empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  equipos                equipos  @relation(fields: [equipoId], references: [id], onDelete: Cascade)

  @@index([empresaId])
}

model equipos {
  id                        String                     @id
  empresaId                 String
  nombre                    String                     @db.VarChar(100)
  managerId                 String?
  descripcion               String?
  activo                    Boolean                    @default(true)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime
  sedeId                    String?
  tipo                      TipoEquipo                 @default(proyecto)
  ausencias                 ausencias[]
  empleado_equipos          empleado_equipos[]
  equipo_politica_ausencias equipo_politica_ausencias?
  empresas                  empresas                   @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  empleados                 empleados?                 @relation(fields: [managerId], references: [id])
  sedes                     sedes?                     @relation(fields: [sedeId], references: [id])

  @@unique([empresaId, nombre])
  @@index([empresaId])
  @@index([managerId])
  @@index([sedeId])
}

model eventos_nomina {
  id                       String           @id
  empresaId                String
  mes                      Int              @db.SmallInt
  anio                     Int              @db.SmallInt
  estado                   String           @default("abierto") @db.VarChar(50)
  fechaGeneracion          DateTime?
  fechaLimiteComplementos  DateTime?
  fechaExportacion         DateTime?
  fechaImportacion         DateTime?
  fechaPublicacion         DateTime?
  fechaCierre              DateTime?
  totalEmpleados           Int              @default(0)
  empleadosConComplementos Int              @default(0)
  complementosAsignados    Int              @default(0)
  nominasImportadas        Int              @default(0)
  createdAt                DateTime         @default(now())
  updatedAt                DateTime
  empresas                 empresas         @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  nominas                  nominas[]
  notificaciones           notificaciones[]

  @@unique([empresaId, mes, anio])
  @@index([empresaId, estado])
  @@index([empresaId, mes, anio])
}

model exports_gestoria {
  id                 String   @id
  empresaId          String
  mes                Int      @db.SmallInt
  anio               Int      @db.SmallInt
  archivoUrl         String
  archivoNombre      String   @db.VarChar(255)
  generadoPor        String?
  generadoEn         DateTime @default(now())
  numEmpleados       Int?
  numAlertasCriticas Int?
  empresas           empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId, anio, mes])
  @@index([generadoEn])
}

model festivos {
  id                String   @id
  empresaId         String
  nombre            String   @db.VarChar(200)
  fecha             DateTime @db.Date
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  activo            Boolean  @default(true)
  comunidadAutonoma String?  @db.VarChar(100)
  origen            String   @default("manual") @db.VarChar(50)
  tipo              String   @db.VarChar(50)
  empresas          empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, fecha])
  @@index([empresaId, fecha, activo])
}

model fichaje_eventos {
  id            String            @id
  fichajeId     String
  hora          DateTime          @db.Timestamptz(6)
  ubicacion     String?
  editado       Boolean           @default(false)
  motivoEdicion String?
  horaOriginal  DateTime?         @db.Timestamptz(6)
  editadoPor    String?
  createdAt     DateTime          @default(now())
  tipo          TipoFichajeEvento
  fichajes      fichajes          @relation(fields: [fichajeId], references: [id], onDelete: Cascade)

  @@index([fichajeId, hora])
  @@index([fichajeId])
  @@index([hora])
  @@index([tipo])
}

model fichajes {
  id                             String                           @id
  empresaId                      String
  empleadoId                     String
  fecha                          DateTime                         @db.Date
  autoCompletado                 Boolean                          @default(false)
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  fechaAprobacion                DateTime?
  horasEnPausa                   Decimal?                         @db.Decimal(5, 2)
  horasTrabajadas                Decimal?                         @db.Decimal(5, 2)
  cuadradoMasivamente            Boolean                          @default(false)
  cuadradoPor                    String?
  cuadradoEn                     DateTime?
  estado                         EstadoFichaje                    @default(en_curso)
  fichaje_eventos                fichaje_eventos[]
  empleados                      empleados                        @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas                       empresas                         @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  solicitudes_correccion_fichaje solicitudes_correccion_fichaje[]

  @@unique([empleadoId, fecha])
  @@index([empleadoId])
  @@index([empresaId, empleadoId, fecha])
  @@index([empresaId, estado])
  @@index([empresaId, fecha])
  @@index([empresaId])
  @@index([estado])
  @@index([fecha])
}

model firmas {
  id                String            @id
  solicitudFirmaId  String
  empleadoId        String
  estado            String            @default("pendiente") @db.VarChar(50)
  enviadoEn         DateTime?
  firmadoEn         DateTime?
  rechazadoEn       DateTime?
  ipAddress         String?           @db.VarChar(50)
  userAgent         String?
  ubicacion         Json?
  certificado       String?
  metodoFirma       String?           @db.VarChar(50)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  certificadoHash   String?
  datosCapturados   Json?
  firmado           Boolean           @default(false)
  metodoCaptura     String            @default("click") @db.VarChar(50)
  numRecordatorios  Int               @default(0)
  orden             Int               @default(0)
  tipo              String            @default("simple") @db.VarChar(50)
  empleados         empleados         @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  solicitudes_firma solicitudes_firma @relation(fields: [solicitudFirmaId], references: [id], onDelete: Cascade)

  @@unique([solicitudFirmaId, empleadoId])
  @@index([empleadoId, firmado])
  @@index([empleadoId])
  @@index([enviadoEn])
  @@index([estado])
  @@index([firmadoEn])
  @@index([firmado])
  @@index([solicitudFirmaId, firmado])
  @@index([solicitudFirmaId])
}

model integraciones {
  id         String   @id
  empresaId  String
  tipo       String   @db.VarChar(50)
  proveedor  String   @db.VarChar(100)
  config     Json?
  activa     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  calendarId String?  @db.VarChar(255)
  usuarioId  String?
  empresas   empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, tipo, proveedor, usuarioId])
  @@index([empresaId])
  @@index([tipo])
  @@index([usuarioId])
}

model invitaciones_empleados {
  id         String    @id
  empresaId  String
  empleadoId String    @unique
  email      String
  token      String    @unique
  expiraEn   DateTime
  aceptada   Boolean   @default(false)
  createdAt  DateTime  @default(now())
  empleados  empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas   empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([empresaId])
  @@index([token])
}

model invitaciones_signup {
  id          String    @id
  email       String    @unique
  token       String    @unique
  expiraEn    DateTime
  usada       Boolean   @default(false)
  usadoEn     DateTime?
  invitadoPor String?
  createdAt   DateTime  @default(now())

  @@index([email])
  @@index([token])
  @@index([usada])
}

model jobs_generacion_documentos {
  id                    String                @id
  empresaId             String
  plantillaId           String
  solicitadoPor         String
  empleadoIds           Json
  configuracion         Json
  estado                String                @default("en_cola") @db.VarChar(50)
  progreso              Int                   @default(0) @db.SmallInt
  totalEmpleados        Int
  procesados            Int                   @default(0)
  exitosos              Int                   @default(0)
  fallidos              Int                   @default(0)
  iniciadoEn            DateTime?
  completadoEn          DateTime?
  tiempoTotal           Int?
  resultados            Json?
  error                 String?
  intentos              Int                   @default(0) @db.SmallInt
  ultimoIntento         DateTime?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  empresas              empresas              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  plantillas_documentos plantillas_documentos @relation(fields: [plantillaId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([empresaId])
  @@index([estado])
  @@index([plantillaId])
  @@index([solicitadoPor])
}

model jornadas {
  id             String      @id
  empresaId      String
  nombre         String      @db.VarChar(100)
  horasSemanales Decimal     @db.Decimal(5, 2)
  config         Json
  esPredefinida  Boolean     @default(false)
  activa         Boolean     @default(true)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime
  empleados      empleados[]
  empresas       empresas    @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
}

model nominas {
  id                       String                     @id
  empleadoId               String
  mes                      Int                        @db.SmallInt
  anio                     Int                        @db.SmallInt
  documentoId              String?                    @unique
  datosExtraidosIA         Json?
  verificado               Boolean                    @default(false)
  tieneAnomalias           Boolean                    @default(false)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  empleadoNotificado       Boolean                    @default(false)
  empleadoVisto            Boolean                    @default(false)
  estado                   String                     @default("pendiente") @db.VarChar(50)
  fechaNotificacion        DateTime?
  fechaPublicacion         DateTime?
  fechaVisto               DateTime?
  subidoPor                String?
  complementosPendientes   Boolean                    @default(false)
  contratoId               String?
  diasAusencias            Int                        @default(0) @db.SmallInt
  diasTrabajados           Int                        @default(0) @db.SmallInt
  eventoNominaId           String?
  exportadaEn              DateTime?
  salarioBase              Decimal                    @db.Decimal(10, 2)
  totalBruto               Decimal                    @db.Decimal(10, 2)
  totalComplementos        Decimal                    @default(0) @db.Decimal(10, 2)
  totalDeducciones         Decimal                    @default(0) @db.Decimal(10, 2)
  totalNeto                Decimal                    @db.Decimal(10, 2)
  alertas_nomina           alertas_nomina[]
  asignaciones_complemento asignaciones_complemento[]
  contratos                contratos?                 @relation(fields: [contratoId], references: [id])
  documentos               documentos?                @relation(fields: [documentoId], references: [id])
  empleados                empleados                  @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  eventos_nomina           eventos_nomina?            @relation(fields: [eventoNominaId], references: [id])

  @@unique([empleadoId, mes, anio])
  @@index([contratoId])
  @@index([documentoId])
  @@index([empleadoId, estado])
  @@index([empleadoId])
  @@index([estado])
  @@index([eventoNominaId, estado])
  @@index([eventoNominaId])
  @@index([mes, anio])
}

model notificaciones {
  id             String          @id
  empresaId      String
  usuarioId      String
  tipo           String          @db.VarChar(50)
  titulo         String          @db.VarChar(255)
  mensaje        String
  metadata       Json?
  leida          Boolean         @default(false)
  createdAt      DateTime        @default(now())
  eventoNominaId String?
  empresas       empresas        @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  eventos_nomina eventos_nomina? @relation(fields: [eventoNominaId], references: [id])
  usuarios       usuarios        @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([empresaId])
  @@index([eventoNominaId])
  @@index([usuarioId, leida])
}

model onboarding_configs {
  id                   String   @id
  empresaId            String   @unique
  camposRequeridos     Json     @default("{\"datos_bancarios\": {\"bic\": true, \"iban\": true}, \"datos_personales\": {\"nif\": true, \"nss\": true, \"ciudad\": true, \"telefono\": true, \"estadoCivil\": false, \"numeroHijos\": false, \"codigoPostal\": true, \"direccionPiso\": false, \"direccionCalle\": true, \"direccionNumero\": true, \"direccionProvincia\": true}}")
  documentosRequeridos Json     @default("[]")
  plantillasDocumentos Json     @default("[]")
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  empresas             empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
}

model onboarding_empleados {
  id              String    @id
  empresaId       String
  empleadoId      String    @unique
  token           String    @unique
  tokenExpira     DateTime
  completado      Boolean   @default(false)
  fechaCompletado DateTime?
  progreso        Json      @default("{\"datos_bancarios\": false, \"datos_documentos\": false, \"datos_personales\": false, \"credenciales_completadas\": false}")
  datosTemporales Json?
  createdAt       DateTime  @default(now())
  tipoOnboarding  String    @default("completo") @db.VarChar(20)
  empleados       empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas        empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empleadoId])
  @@index([empresaId])
  @@index([token])
}

model plantillas_documentos {
  id                         String                       @id
  empresaId                  String?
  nombre                     String                       @db.VarChar(255)
  descripcion                String?
  categoria                  String                       @db.VarChar(100)
  tipo                       String                       @db.VarChar(50)
  formato                    String                       @db.VarChar(20)
  s3Key                      String                       @unique
  s3Bucket                   String                       @db.VarChar(255)
  variablesUsadas            Json                         @default("[]")
  activa                     Boolean                      @default(true)
  esOficial                  Boolean                      @default(false)
  requiereContrato           Boolean                      @default(false)
  requiereFirma              Boolean                      @default(false)
  carpetaDestinoDefault      String?                      @db.VarChar(50)
  usarIAParaExtraer          Boolean                      @default(false)
  configuracionIA            Json?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  autoGenerarOffboarding     Boolean                      @default(false)
  autoGenerarOnboarding      Boolean                      @default(false)
  permiteRellenar            Boolean                      @default(false)
  requiereRevision           Boolean                      @default(false)
  documentos_generados       documentos_generados[]
  jobs_generacion_documentos jobs_generacion_documentos[]
  empresas                   empresas?                    @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([activa])
  @@index([categoria])
  @@index([empresaId])
  @@index([esOficial])
  @@index([tipo])
}

model preferencias_vacaciones {
  id                  String              @id
  campanaId           String
  empleadoId          String
  empresaId           String
  diasIdeales         Json
  diasPrioritarios    Json?
  diasAlternativos    Json?
  completada          Boolean             @default(false)
  aceptada            Boolean             @default(false)
  propuestaIA         Json?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  propuestaEnviada    Boolean             @default(false)
  cambioSolicitado    Boolean             @default(false)
  propuestaEmpleado   Json?
  campanas_vacaciones campanas_vacaciones @relation(fields: [campanaId], references: [id], onDelete: Cascade)
  empleados           empleados           @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas            empresas            @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([campanaId, empleadoId])
  @@index([campanaId])
  @@index([completada])
  @@index([empleadoId])
  @@index([empresaId])
}

model puestos {
  id          String       @id
  empresaId   String
  nombre      String       @db.VarChar(100)
  descripcion String?
  activo      Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  documentos  documentos[]
  empleados   empleados[]
  empresas    empresas     @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, nombre])
  @@index([empresaId])
}

model resumenes_mensuales_nomina {
  id                        String    @id
  empresaId                 String
  empleadoId                String
  mes                       Int       @db.SmallInt
  anio                      Int       @db.SmallInt
  diasLaborables            Int       @default(0)
  diasTrabajados            Int       @default(0)
  diasVacaciones            Int       @default(0)
  diasBajaIT                Int       @default(0)
  diasPermisosRetribuidos   Int       @default(0)
  diasPermisosNoRetribuidos Int       @default(0)
  horasTrabajadas           Decimal   @default(0) @db.Decimal(10, 2)
  horasExtras               Decimal   @default(0) @db.Decimal(10, 2)
  salarioBase               Decimal?  @db.Decimal(10, 2)
  calculadoEn               DateTime  @default(now())
  empleados                 empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas                  empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, empleadoId, mes, anio])
  @@index([empleadoId])
  @@index([empresaId, anio, mes])
}

model sedes {
  id        String    @id
  empresaId String
  nombre    String    @db.VarChar(200)
  ciudad    String    @db.VarChar(100)
  createdAt DateTime  @default(now())
  updatedAt DateTime
  activo    Boolean   @default(true)
  equipos   equipos[]
  empresas  empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
}

model sesiones_activas {
  id        String   @id
  usuarioId String
  tokenHash String   @unique
  ipAddress String?  @db.VarChar(50)
  userAgent String?
  createdAt DateTime @default(now())
  ultimoUso DateTime @default(now())
  expiraEn  DateTime
  usuarios  usuarios @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([expiraEn])
  @@index([tokenHash])
  @@index([usuarioId])
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  usuarios     usuarios @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model solicitudes_cambio {
  id                                                  String          @id
  empresaId                                           String
  empleadoId                                          String
  aprobadorId                                         String?
  tipo                                                String          @db.VarChar(100)
  camposCambiados                                     Json
  motivo                                              String?
  motivoRechazo                                       String?
  fechaRespuesta                                      DateTime?
  createdAt                                           DateTime        @default(now())
  updatedAt                                           DateTime
  requiereAprobacionManual                            Boolean         @default(false)
  revisadaPorIA                                       Boolean         @default(false)
  revisionIA                                          Json?
  estado                                              EstadoSolicitud @default(pendiente)
  empleados_solicitudes_cambio_aprobadorIdToempleados empleados?      @relation("solicitudes_cambio_aprobadorIdToempleados", fields: [aprobadorId], references: [id])
  empleados_solicitudes_cambio_empleadoIdToempleados  empleados       @relation("solicitudes_cambio_empleadoIdToempleados", fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas                                            empresas        @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([aprobadorId])
  @@index([empleadoId])
  @@index([empresaId, estado])
  @@index([empresaId])
  @@index([estado])
}

model solicitudes_correccion_fichaje {
  id                                                              String                           @id
  empresaId                                                       String
  fichajeId                                                       String
  empleadoId                                                      String
  estado                                                          EstadoSolicitudCorreccionFichaje @default(pendiente)
  motivo                                                          String
  detalles                                                        Json
  respuesta                                                       String?
  revisadaPor                                                     String?
  revisadaEn                                                      DateTime?
  createdAt                                                       DateTime                         @default(now())
  updatedAt                                                       DateTime
  empleados_solicitudes_correccion_fichaje_empleadoIdToempleados  empleados                        @relation("solicitudes_correccion_fichaje_empleadoIdToempleados", fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas                                                        empresas                         @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  fichajes                                                        fichajes                         @relation(fields: [fichajeId], references: [id], onDelete: Cascade)
  empleados_solicitudes_correccion_fichaje_revisadaPorToempleados empleados?                       @relation("solicitudes_correccion_fichaje_revisadaPorToempleados", fields: [revisadaPor], references: [id])

  @@index([empleadoId])
  @@index([empresaId])
  @@index([estado])
  @@index([fichajeId])
  @@index([revisadaPor])
}

model solicitudes_eliminacion_datos {
  id             String    @id
  empresaId      String
  empleadoId     String
  solicitantePor String
  estado         String    @default("pendiente") @db.VarChar(50)
  motivo         String?
  respuesta      String?
  completadaEn   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime
  empleados      empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresas       empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empleadoId])
  @@index([empresaId])
  @@index([estado])
}

model solicitudes_firma {
  id                     String     @id
  empresaId              String
  documentoId            String
  solicitadoPor          String?    @db.VarChar(100)
  solicitadoEn           DateTime?  @default(now())
  mensaje                String?
  fechaLimite            DateTime?
  estado                 String     @default("pendiente") @db.VarChar(50)
  tipo                   String     @default("individual") @db.VarChar(50)
  proveedor              String     @default("interno") @db.VarChar(50)
  completadaEn           DateTime?
  expiradaEn             DateTime?
  canceladaEn            DateTime?
  createdAt              DateTime   @default(now())
  updatedAt              DateTime
  pdfFirmadoS3Key        String?
  creadoPor              String?    @db.VarChar(100)
  diasRecordatorio       Int        @default(3)
  hashDocumento          String
  motivoCancelacion      String?
  nombreDocumento        String     @db.VarChar(255)
  ordenFirma             Boolean    @default(false)
  recordatorioAutomatico Boolean    @default(true)
  titulo                 String     @db.VarChar(255)
  posicionFirma          Json?
  firmas                 firmas[]
  documentos             documentos @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  empresas               empresas   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([documentoId])
  @@index([empresaId, createdAt])
  @@index([empresaId, estado])
  @@index([empresaId])
  @@index([estado])
  @@index([fechaLimite])
  @@index([solicitadoPor])
  @@index([tipo])
}

model subscriptions {
  id                 String             @id
  empresaId          String
  customerId         String
  priceId            String
  status             SubscriptionStatus @default(active)
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  trialStart         DateTime?
  trialEnd           DateTime?
  cancelAtPeriodEnd  Boolean            @default(false)
  canceledAt         DateTime?
  metadata           Json?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  billing_customers  billing_customers  @relation(fields: [customerId], references: [id], onDelete: Cascade)
  empresas           empresas           @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  billing_prices     billing_prices     @relation(fields: [priceId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([empresaId])
  @@index([priceId])
  @@index([status])
}

model tipos_complemento {
  id                    String                  @id
  empresaId             String
  nombre                String                  @db.VarChar(200)
  descripcion           String?
  esImporteFijo         Boolean                 @default(true)
  importeFijo           Decimal?                @db.Decimal(10, 2)
  activo                Boolean                 @default(true)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  empleado_complementos empleado_complementos[]
  empresas              empresas                @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId, activo])
}

model usuarios {
  id                String              @id
  empresaId         String
  empleadoId        String?             @unique
  email             String              @unique @db.VarChar(255)
  cognitoId         String?             @unique @db.VarChar(255)
  nombre            String              @db.VarChar(100)
  apellidos         String              @db.VarChar(200)
  avatar            String?
  activo            Boolean             @default(true)
  emailVerificado   Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  ultimoAcceso      DateTime?
  password          String?             @db.VarChar(255)
  googleId          String?             @unique @db.VarChar(255)
  rol               UsuarioRol          @default(empleado)
  backupCodes       Json?
  totpEnabled       Boolean             @default(false)
  totpEnabledAt     DateTime?
  totpSecret        String?
  accounts          accounts[]
  auditoria_accesos auditoria_accesos[]
  empleados         empleados?
  notificaciones    notificaciones[]
  sesiones_activas  sesiones_activas[]
  sessions          sessions[]
  empresas          empresas            @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([cognitoId])
  @@index([email])
  @@index([empresaId])
  @@index([googleId])
}

model variable_mappings {
  id                 String   @id
  variableName       String   @unique @db.VarChar(200)
  jsonPath           String
  requiresDecryption Boolean  @default(false)
  requiresFormatting Boolean  @default(false)
  formatType         String?  @db.VarChar(50)
  formatPattern      String?  @db.VarChar(100)
  generadoPorIA      Boolean  @default(true)
  confianza          Decimal  @db.Decimal(3, 2)
  verificado         Boolean  @default(false)
  vecesUsado         Int      @default(0)
  ultimoUso          DateTime @default(now())
  createdAt          DateTime @default(now())
  updatedAt          DateTime

  @@index([ultimoUso])
  @@index([variableName])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model waitlist {
  id         String    @id
  email      String    @unique
  nombre     String?   @db.VarChar(200)
  empresa    String?   @db.VarChar(200)
  mensaje    String?
  invitado   Boolean   @default(false)
  invitadoEn DateTime?
  createdAt  DateTime  @default(now())

  @@index([email])
  @@index([invitado])
}

enum BillingInterval {
  month
  year
}

enum EstadoAusencia {
  pendiente
  confirmada
  completada
  rechazada
}

enum EstadoEmpleado {
  activo
  baja
  suspendido
}

enum EstadoFichaje {
  en_curso
  pendiente
  finalizado
}

enum EstadoSolicitud {
  pendiente
  requiere_revision
  auto_aprobada
  aprobada_manual
  rechazada
}

enum EstadoSolicitudCorreccionFichaje {
  pendiente
  aprobada
  rechazada
}

enum PeriodoMedioDia {
  manana
  tarde
}

enum SubscriptionStatus {
  trialing
  active
  canceled
  incomplete
  incomplete_expired
  past_due
  unpaid
  paused
}

enum TipoAusencia {
  vacaciones
  enfermedad
  enfermedad_familiar
  maternidad_paternidad
  otro
}

enum TipoContrato {
  indefinido
  temporal
  administrador
  fijo_discontinuo
  becario
  practicas
  obra_y_servicio
}

enum TipoEquipo {
  proyecto
  squad
  temporal
}

enum TipoFichajeEvento {
  entrada
  pausa_inicio
  pausa_fin
  salida
}

enum UsuarioRol {
  platform_admin
  hr_admin
  manager
  empleado
}
