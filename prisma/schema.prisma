generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accounts {
  id                String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  usuario           usuarios @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model alertas_nomina {
  id              String     @id @default(cuid())
  empresaId       String
  nominaId        String?
  tipo            String     @db.VarChar(50)
  mensaje         String
  resuelta        Boolean    @default(false)
  fechaResolucion DateTime?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  accionUrl       String?
  categoria       String     @db.VarChar(100)
  codigo          String     @db.VarChar(100)
  detalles        Json?
  empleadoId      String?
  empleado        empleados? @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa         empresas   @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  nomina          nominas?   @relation(fields: [nominaId], references: [id], onDelete: Cascade)

  @@index([categoria])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([nominaId])
  @@index([resuelta])
  @@index([tipo])
}

model asignaciones_complemento {
  id                    String                @id @default(cuid())
  nominaId              String
  empleadoComplementoId String
  importe               Decimal               @db.Decimal(10, 2)
  asignadoPor           String?
  fechaAsignacion       DateTime              @default(now())
  notas                 String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  empleado_complementos empleado_complementos @relation(fields: [empleadoComplementoId], references: [id], onDelete: Cascade)
  nomina                nominas               @relation(fields: [nominaId], references: [id], onDelete: Cascade)

  @@unique([nominaId, empleadoComplementoId])
  @@index([empleadoComplementoId])
  @@index([nominaId])
}

model auditoria_accesos {
  id                 String   @id @default(cuid())
  empresaId          String
  usuarioId          String
  empleadoAccedidoId String?
  accion             String   @db.VarChar(50)
  recurso            String   @db.VarChar(100)
  camposAccedidos    Json?
  ipAddress          String?  @db.VarChar(50)
  userAgent          String?
  motivo             String?
  createdAt          DateTime @default(now())
  empresa            empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  usuario            usuarios @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([accion])
  @@index([createdAt])
  @@index([empleadoAccedidoId])
  @@index([empresaId])
  @@index([recurso])
  @@index([usuarioId])
}

model ausencias {
  id                         String                      @id @default(cuid())
  empresaId                  String
  empleadoId                 String
  fechaInicio                DateTime                    @db.Date
  fechaFin                   DateTime                    @db.Date
  diasNaturales              Int
  diasLaborables             Int
  motivo                     String?
  estado                     EstadoAusencia              @default(pendiente)
  aprobadaPor                String?
  aprobadaEn                 DateTime?
  motivoRechazo              String?
  documentoId                String?
  optimizadaIA               Boolean                     @default(false)
  notasIA                    String?
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime                    @updatedAt
  descuentaSaldo             Boolean                     @default(false)
  diasAlternativos           Json?
  diasIdeales                Json?
  diasPrioritarios           Json?
  diasSolicitados            Decimal                     @db.Decimal(4, 1)
  equipoId                   String?
  justificanteUrl            String?
  medioDia                   Boolean                     @default(false)
  revisionIA                 Json?
  periodo                    PeriodoMedioDia?
  tipo                       TipoAusencia
  diasDesdeCarryOver         Decimal                     @default(0) @db.Decimal(4, 1)
  documento                  documentos?                 @relation(fields: [documentoId], references: [id])
  empleado                   empleados                   @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa                    empresas                    @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  equipo                     equipos?                    @relation(fields: [equipoId], references: [id])
  compensaciones_horas_extra compensaciones_horas_extra?

  @@index([documentoId])
  @@index([empleadoId])
  @@index([empresaId, empleadoId, estado])
  @@index([empresaId, estado])
  @@index([empresaId])
  @@index([empresaId, tipo, estado])
  @@index([equipoId])
  @@index([estado])
  @@index([fechaInicio, fechaFin])
  @@index([tipo])
}

model auto_completados {
  id              String    @id @default(cuid())
  empresaId       String
  empleadoId      String
  tipo            String    @db.VarChar(50)
  estado          String    @default("pendiente") @db.VarChar(50)
  expiraEn        DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  aprobadoEn      DateTime?
  aprobadoPor     String?
  datosOriginales Json
  sugerencias     Json
  empleado        empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa         empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empleadoId])
  @@index([empresaId, estado, expiraEn])
  @@index([empresaId])
  @@index([empresaId, tipo, estado])
  @@index([estado])
  @@index([expiraEn])
  @@index([tipo])
}

model billing_customers {
  id            String          @id @default(cuid())
  empresaId     String          @unique
  email         String          @db.VarChar(255)
  nombre        String?         @db.VarChar(255)
  direccion     Json?
  taxId         String?         @db.VarChar(50)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  empresa       empresas        @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  subscriptions subscriptions[]

  @@index([empresaId])
}

model billing_prices {
  id               String           @id @default(cuid())
  productoId       String
  unitAmount       Int
  currency         String           @default("eur") @db.VarChar(3)
  intervalo        BillingInterval  @default(month)
  intervalCount    Int              @default(1)
  trialDays        Int?
  activo           Boolean          @default(true)
  metadata         Json?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  billing_products billing_products @relation(fields: [productoId], references: [id], onDelete: Cascade)
  subscriptions    subscriptions[]

  @@index([activo])
  @@index([productoId])
}

model billing_products {
  id             String           @id @default(cuid())
  nombre         String           @db.VarChar(255)
  descripcion    String?
  activo         Boolean          @default(true)
  imagen         String?
  features       Json             @default("[]")
  orden          Int              @default(0)
  metadata       Json?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  billing_prices billing_prices[]

  @@index([activo])
  @@index([orden])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model campanas_vacaciones {
  id                      String                    @id @default(cuid())
  empresaId               String
  titulo                  String                    @db.VarChar(200)
  alcance                 String                    @default("todos") @db.VarChar(50)
  equipoIds               Json?
  estado                  String                    @default("abierta") @db.VarChar(50)
  solapamientoMaximoPct   Int?
  propuestaIA             Json?
  totalEmpleadosAsignados Int                       @default(0)
  empleadosCompletados    Int                       @default(0)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  cerradaEn               DateTime?
  cuadradaEn              DateTime?
  fechaFinObjetivo        DateTime                  @db.Date
  fechaInicioObjetivo     DateTime                  @db.Date
  finalizadaEn            DateTime?
  empresa                 empresas                  @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  preferencias            preferencias_vacaciones[]

  @@index([empresaId])
  @@index([estado])
}

model carpetas {
  id                    String                @id @default(cuid())
  empresaId             String
  empleadoId            String?
  nombre                String                @db.VarChar(255)
  parentId              String?
  esSistema             Boolean               @default(false)
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  asignadoA             String?
  compartida            Boolean               @default(false)
  vinculadaAProceso     String?               @db.VarChar(50)
  requiereFirma         Boolean               @default(false)
  requiereRellenarDatos Boolean               @default(false)
  camposRequeridos      Json?
  empleado              empleados?            @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa               empresas              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  parent                carpetas?             @relation("carpetasTocarpetas", fields: [parentId], references: [id], onDelete: Cascade)
  subcarpetas           carpetas[]            @relation("carpetasTocarpetas")
  documento_carpetas    documento_carpetas[]

  @@index([compartida])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([parentId])
  @@index([vinculadaAProceso])
}

model compensaciones_horas_extra {
  id               String     @id @default(cuid())
  empresaId        String
  empleadoId       String
  horasBalance     Decimal    @db.Decimal(5, 2)
  tipoCompensacion String     @db.VarChar(50)
  estado           String     @default("pendiente") @db.VarChar(50)
  diasAusencia     Decimal?   @db.Decimal(4, 1)
  ausenciaId       String?    @unique
  nominaId         String?
  aprobadoPor      String?
  aprobadoEn       DateTime?
  motivoRechazo    String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  ausencia         ausencias? @relation(fields: [ausenciaId], references: [id])
  empleado         empleados  @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa          empresas   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empleadoId])
  @@index([empresaId])
  @@index([estado])
}

model consentimientos {
  id          String    @id @default(cuid())
  empresaId   String
  empleadoId  String
  tipo        String    @db.VarChar(100)
  descripcion String
  otorgado    Boolean   @default(false)
  otorgadoEn  DateTime?
  revocadoEn  DateTime?
  version     String    @db.VarChar(50)
  ipAddress   String?   @db.VarChar(50)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  empleado    empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa     empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, empleadoId, tipo])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([otorgado])
  @@index([tipo])
}

model contratos {
  id                    String                  @id @default(cuid())
  empleadoId            String
  fechaInicio           DateTime                @db.Date
  fechaFin              DateTime?               @db.Date
  salarioBaseAnual      Decimal                 @db.Decimal(10, 2)
  documentoId           String?                 @unique
  datosExtraidosIA      Json?
  verificado            Boolean                 @default(false)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  tipoContrato          TipoContrato
  empleado              empleados               @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empleado_complementos empleado_complementos[]
  nominas               nominas[]

  @@index([empleadoId])
  @@index([tipoContrato])
}

model denuncias {
  id            String     @id @default(cuid())
  empresaId     String
  denuncianteId String?
  descripcion   String
  esAnonima     Boolean    @default(false)
  documentos    Json?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  denunciante   empleados? @relation(fields: [denuncianteId], references: [id])
  empresa       empresas   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([denuncianteId])
  @@index([empresaId])
}

model documentos {
  id                     String                @id @default(cuid())
  empresaId              String
  empleadoId             String?
  nombre                 String                @db.VarChar(255)
  tipoDocumento          String                @db.VarChar(100)
  mimeType               String                @db.VarChar(100)
  tamano                 Int
  s3Key                  String                @unique
  s3Bucket               String                @db.VarChar(255)
  procesadoIA            Boolean               @default(false)
  datosExtraidos         Json?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  puestoId               String?
  requiereFirma          Boolean               @default(false)
  firmado                Boolean               @default(false)
  firmadoEn              DateTime?
  hashDocumento          String?
  generadoDesdePlantilla Boolean               @default(false)
  ausencias              ausencias[]
  empleado               empleados?            @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa                empresas              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  puestoRelacion         puestos?              @relation(fields: [puestoId], references: [id], onDelete: Cascade)
  documentoGenerado      documentosGenerado?
  nominas                nominas?
  solicitudes_firma      solicitudes_firma[]
  documento_carpetas     documento_carpetas[]

  @@index([empleadoId])
  @@index([empresaId])
  @@index([generadoDesdePlantilla])
  @@index([puestoId])
  @@index([requiereFirma, firmado])
  @@index([s3Key])
  @@index([tipoDocumento])
}

model documento_carpetas {
  documentoId String
  carpetaId   String
  createdAt   DateTime   @default(now())
  documento   documentos @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  carpeta     carpetas   @relation(fields: [carpetaId], references: [id], onDelete: Cascade)

  @@id([documentoId, carpetaId])
  @@index([documentoId])
  @@index([carpetaId])
}

model documentosGenerado {
  id                    String                @id @default(cuid())
  empresaId             String
  empleadoId            String
  plantillaId           String
  documentoId           String                @unique
  generadoPor           String?
  generadoEn            DateTime              @default(now())
  variablesUtilizadas   Json
  usadaIA               Boolean               @default(false)
  confianzaIA           Decimal?              @db.Decimal(3, 2)
  tiempoGeneracion      Int?
  notificado            Boolean               @default(false)
  visto                 Boolean               @default(false)
  vistoEn               DateTime?
  requiereFirma         Boolean               @default(false)
  firmado               Boolean               @default(false)
  firmadoEn             DateTime?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  camposCompletados     Json?
  pendienteRellenar     Boolean               @default(false)
  rellenadoEn           DateTime?
  documento             documentos            @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  empleado              empleados             @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa               empresas              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  plantillas_documentos plantillas_documentos @relation(fields: [plantillaId], references: [id], onDelete: Cascade)

  @@index([documentoId])
  @@index([empleadoId])
  @@index([empresaId])
  @@index([firmado])
  @@index([generadoEn])
  @@index([plantillaId])
  @@index([usadaIA])
  @@map("documentos_generados")
}

model empleado_complementos {
  id                       String                     @id @default(cuid())
  empleadoId               String
  tipoComplementoId        String
  contratoId               String?
  esImporteFijo            Boolean                    @default(true)
  importePersonalizado     Decimal                    @db.Decimal(10, 2)
  activo                   Boolean                    @default(true)
  validado                 Boolean                    @default(false)
  validadoPor              String?
  fechaValidacion          DateTime?
  rechazado                Boolean                    @default(false)
  motivoRechazo            String?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  asignaciones_complemento asignaciones_complemento[]
  contrato                 contratos?                 @relation(fields: [contratoId], references: [id])
  empleado                 empleados                  @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  tipos_complemento        tipos_complemento          @relation(fields: [tipoComplementoId], references: [id], onDelete: Cascade)

  @@index([contratoId])
  @@index([empleadoId, activo])
  @@index([tipoComplementoId])
}

model empleado_equipos {
  empleadoId         String
  equipoId           String
  fechaIncorporacion DateTime  @default(now())
  empleado           empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  equipo             equipos   @relation(fields: [equipoId], references: [id], onDelete: Cascade)

  @@id([empleadoId, equipoId])
  @@index([empleadoId])
  @@index([equipoId])
}

model empleadoSaldoAusencias {
  id                  String    @id @default(cuid())
  empleadoId          String
  empresaId           String
  anio                Int       @map("año") @db.SmallInt
  diasTotales         Int       @default(0)
  diasUsados          Decimal   @default(0) @db.Decimal(4, 1)
  diasPendientes      Decimal   @default(0) @db.Decimal(4, 1)
  origen              String    @db.VarChar(50)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  carryOverAsignado   Decimal   @default(0) @db.Decimal(4, 1)
  carryOverExpiraEn   DateTime?
  carryOverFuenteAnio Int?      @db.SmallInt
  carryOverPendiente  Decimal   @default(0) @db.Decimal(4, 1)
  carryOverUsado      Decimal   @default(0) @db.Decimal(4, 1)
  empleado            empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa             empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empleadoId, anio], map: "empleado_saldo_ausencias_empleadoId_año_key")
  @@index([empleadoId, anio], map: "empleado_saldo_ausencias_empleadoId_año_idx")
  @@index([empresaId])
  @@map("empleado_saldo_ausencias")
}

model empleados {
  id                                                                                   String                           @id @default(cuid())
  empresaId                                                                            String
  usuarioId                                                                            String                           @unique
  nombre                                                                               String                           @db.VarChar(100)
  apellidos                                                                            String                           @db.VarChar(200)
  email                                                                                String                           @unique @db.VarChar(255)
  fotoUrl                                                                              String?
  nif                                                                                  String?                          @unique
  nss                                                                                  String?
  fechaNacimiento                                                                      DateTime?
  telefono                                                                             String?                          @db.VarChar(20)
  codigoPostal                                                                         String?                          @db.VarChar(5)
  ciudad                                                                               String?                          @db.VarChar(100)
  estadoCivil                                                                          String?                          @db.VarChar(50)
  numeroHijos                                                                          Int                              @default(0) @db.SmallInt
  genero                                                                               String?                          @db.VarChar(50)
  iban                                                                                 String?
  bic                                                                                  String?                          @db.VarChar(11)
  puesto                                                                               String?                          @db.VarChar(100)
  fechaAlta                                                                            DateTime
  fechaBaja                                                                            DateTime?
  categoriaProfesional                                                                 String?                          @db.VarChar(50)
  grupoCotizacion                                                                      Int?                             @db.SmallInt
  managerId                                                                            String?
  jornadaId                                                                            String?
  salarioBaseAnual                                                                     Decimal?                         @db.Decimal(10, 2)
  salarioBaseMensual                                                                   Decimal?                         @db.Decimal(10, 2)
  diasVacaciones                                                                       Int                              @default(22)
  onboardingCompletado                                                                 Boolean                          @default(false)
  onboardingCompletadoEn                                                               DateTime?
  documentosCompletos                                                                  Boolean                          @default(false)
  documentosCompletadosEn                                                              DateTime?
  activo                                                                               Boolean                          @default(true)
  createdAt                                                                            DateTime                         @default(now())
  updatedAt                                                                            DateTime                         @updatedAt
  puestoId                                                                             String?
  direccionCalle                                                                       String?                          @db.VarChar(200)
  direccionNumero                                                                      String?                          @db.VarChar(10)
  direccionPiso                                                                        String?                          @db.VarChar(100)
  direccionProvincia                                                                   String?                          @db.VarChar(100)
  firmaGuardada                                                                        Boolean                          @default(false)
  firmaS3Key                                                                           String?
  firmaGuardadaData                                                                    Json?
  nivelEducacion                                                                       String?                          @db.VarChar(50)
  tipoContrato                                                                         TipoContrato                     @default(indefinido)
  estadoEmpleado                                                                       EstadoEmpleado                   @default(activo)
  saldoRenovadoDesde                                                                   DateTime?
  diasAusenciasPersonalizados                                                          Int?
  alertas_nomina                                                                       alertas_nomina[]
  ausencias                                                                            ausencias[]
  auto_completados                                                                     auto_completados[]
  carpetas                                                                             carpetas[]
  compensaciones_horas_extra                                                           compensaciones_horas_extra[]
  consentimientos                                                                      consentimientos[]
  contratos                                                                            contratos[]
  denuncias                                                                            denuncias[]
  documentos                                                                           documentos[]
  documentosGenerados                                                                  documentosGenerado[]
  empleado_complementos                                                                empleado_complementos[]
  saldosAusencias                                                                      empleadoSaldoAusencias[]
  empleado_festivos                                                                    empleado_festivos[]
  empresa                                                                              empresas                         @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  jornada                                                                              jornadas?                        @relation(fields: [jornadaId], references: [id])
  manager                                                                              empleados?                       @relation("empleadosToempleados", fields: [managerId], references: [id])
  other_empleados                                                                      empleados[]                      @relation("empleadosToempleados")
  puestoRelacion                                                                       puestos?                         @relation(fields: [puestoId], references: [id])
  usuario                                                                              usuarios                         @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  equipos                                                                              empleado_equipos[]
  equiposGestionados                                                                   equipos[]                        @relation("EquiposManager")
  fichajes                                                                             fichajes[]
  firmas                                                                               firmas[]
  invitaciones_empleados                                                               invitaciones_empleados?
  nominas                                                                              nominas[]
  onboarding_empleados                                                                 onboarding_empleados?
  preferencias_vacaciones                                                              preferencias_vacaciones[]
  resumenes_mensuales_nomina                                                           resumenes_mensuales_nomina[]
  solicitudes_cambio_solicitudes_cambio_aprobadorIdToempleados                         solicitudes_cambio[]             @relation("solicitudes_cambio_aprobadorIdToempleados")
  solicitudes_cambio_solicitudes_cambio_empleadoIdToempleados                          solicitudes_cambio[]             @relation("solicitudes_cambio_empleadoIdToempleados")
  solicitudes_correccion_fichaje_solicitudes_correccion_fichaje_empleadoIdToempleados  solicitudes_correccion_fichaje[] @relation("solicitudes_correccion_fichaje_empleadoIdToempleados")
  solicitudes_correccion_fichaje_solicitudes_correccion_fichaje_revisadaPorToempleados solicitudes_correccion_fichaje[] @relation("solicitudes_correccion_fichaje_revisadaPorToempleados")
  solicitudes_eliminacion_datos                                                        solicitudes_eliminacion_datos[]

  @@index([email])
  @@index([empresaId])
  @@index([estadoEmpleado])
  @@index([jornadaId])
  @@index([managerId])
  @@index([nif])
  @@index([puestoId])
  @@index([usuarioId])
}

model empresas {
  id                             String                           @id @default(cuid())
  nombre                         String                           @db.VarChar(200)
  cif                            String?                          @unique @db.VarChar(20)
  email                          String?                          @db.VarChar(255)
  telefono                       String?                          @db.VarChar(20)
  direccion                      String?
  logoUrl                        String?
  // Configuration (JSONB for flexibility)
  // config contains:
  // - hora_cierre_fichaje_default: string (e.g., "18:00")
  // - auto_completado_fichajes_dias: number
  // - auto_completado_nominas_dias: number
  // - auto_completado_contratos_dias: number
  // - umbral_ia_nominas: number (0-1)
  // - umbral_ia_contratos: number (0-1)
  // - permitir_saldo_vacaciones_negativo: boolean
  // - empleado_puede_ver_salario: boolean
  // - diasLaborables: { lunes: boolean, martes: boolean, ... } (optional)
  // - limiteInferiorFichaje: string (e.g., "07:00") - Global lower time limit for all jornadas
  // - limiteSuperiorFichaje: string (e.g., "21:00") - Global upper time limit for all jornadas
  config                         Json                             @default("{\"umbral_ia_nominas\": 0.8, \"umbral_ia_contratos\": 0.85, \"empleado_puede_ver_salario\": false, \"hora_cierre_fichaje_default\": \"18:00\", \"auto_completado_nominas_dias\": 7, \"auto_completado_fichajes_dias\": 7, \"auto_completado_contratos_dias\": 14, \"permitir_saldo_vacaciones_negativo\": true}")
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime                         @updatedAt
  web                            String?                          @db.VarChar(255)
  activo                         Boolean                          @default(true)
  alertas_nomina                 alertas_nomina[]
  auditoria_accesos              auditoria_accesos[]
  ausencias                      ausencias[]
  auto_completados               auto_completados[]
  billing_customers              billing_customers?
  campanas_vacaciones            campanas_vacaciones[]
  carpetas                       carpetas[]
  compensaciones_horas_extra     compensaciones_horas_extra[]
  consentimientos                consentimientos[]
  denuncias                      denuncias[]
  documentos                     documentos[]
  documentosGenerados            documentosGenerado[]
  empleadoSaldoAusencias         empleadoSaldoAusencias[]
  empleados                      empleados[]
  equipo_politica_ausencias      equipo_politica_ausencias[]
  equipos                        equipos[]
  eventos_nomina                 eventos_nomina[]
  exports_gestoria               exports_gestoria[]
  festivos                       festivos[]
  fichajes                       fichajes[]
  integraciones                  integraciones[]
  invitaciones_empleados         invitaciones_empleados[]
  jobs_generacion_documentos     jobs_generacion_documentos[]
  jornadas                       jornadas[]
  notificaciones                 notificaciones[]
  onboarding_configs             onboarding_configs?
  onboarding_empleados           onboarding_empleados[]
  plantillas_documentos          plantillas_documentos[]
  preferencias_vacaciones        preferencias_vacaciones[]
  puestos                        puestos[]
  resumenes_mensuales_nomina     resumenes_mensuales_nomina[]
  sedes                          sedes[]
  solicitudes_cambio             solicitudes_cambio[]
  solicitudes_correccion_fichaje solicitudes_correccion_fichaje[]
  solicitudes_eliminacion_datos  solicitudes_eliminacion_datos[]
  solicitudes_firma              solicitudes_firma[]
  subscriptions                  subscriptions[]
  tipos_complemento              tipos_complemento[]
  usuarios                       usuarios[]

  @@index([cif])
}

model equipo_politica_ausencias {
  equipoId               String   @id @default(cuid())
  empresaId              String
  maxSolapamientoPct     Int      @default(50)
  requiereAntelacionDias Int      @default(5)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  empresa                empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  equipos                equipos  @relation(fields: [equipoId], references: [id], onDelete: Cascade)

  @@index([empresaId])
}

model equipos {
  id                        String                     @id @default(cuid())
  empresaId                 String
  nombre                    String                     @db.VarChar(100)
  managerId                 String?
  descripcion               String?
  activo                    Boolean                    @default(true)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  sedeId                    String?
  tipo                      TipoEquipo                 @default(proyecto)
  ausencias                 ausencias[]
  empleado_equipos          empleado_equipos[]
  equipo_politica_ausencias equipo_politica_ausencias?
  empresa                   empresas                   @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  empleados                 empleados?                 @relation("EquiposManager", fields: [managerId], references: [id])
  sede                      sedes?                     @relation(fields: [sedeId], references: [id])

  @@unique([empresaId, nombre])
  @@index([empresaId])
  @@index([managerId])
  @@index([sedeId])
}

model eventos_nomina {
  id                       String           @id @default(cuid())
  empresaId                String
  mes                      Int              @db.SmallInt
  anio                     Int              @db.SmallInt
  estado                   String           @default("abierto") @db.VarChar(50)
  fechaGeneracion          DateTime?
  fechaLimiteComplementos  DateTime?
  fechaExportacion         DateTime?
  fechaImportacion         DateTime?
  fechaPublicacion         DateTime?
  fechaCierre              DateTime?
  totalEmpleados           Int              @default(0)
  empleadosConComplementos Int              @default(0)
  complementosAsignados    Int              @default(0)
  nominasImportadas        Int              @default(0)
  createdAt                DateTime         @default(now())
  updatedAt                DateTime         @updatedAt
  empresa                  empresas         @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  nominas                  nominas[]
  notificaciones           notificaciones[]

  @@unique([empresaId, mes, anio])
  @@index([empresaId, estado])
  @@index([empresaId, mes, anio])
}

model exports_gestoria {
  id                 String   @id @default(cuid())
  empresaId          String
  mes                Int      @db.SmallInt
  anio               Int      @db.SmallInt
  archivoUrl         String
  archivoNombre      String   @db.VarChar(255)
  generadoPor        String?
  generadoEn         DateTime @default(now())
  numEmpleados       Int?
  numAlertasCriticas Int?
  empresa            empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId, anio, mes])
  @@index([generadoEn])
}

model festivos {
  id                   String               @id @default(cuid())
  empresaId            String
  nombre               String               @db.VarChar(200)
  fecha                DateTime             @db.Date
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  activo               Boolean              @default(true)
  comunidadAutonoma    String?              @db.VarChar(100)
  origen               String               @default("manual") @db.VarChar(50)
  tipo                 String               @db.VarChar(50)
  empresa              empresas             @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  empleado_festivos    empleado_festivos[]

  @@unique([empresaId, fecha])
  @@index([empresaId, fecha, activo])
}

model empleado_festivos {
  id                String    @id @default(cuid())
  empleadoId        String
  festivoEmpresaId  String
  fecha             DateTime  @db.Date
  nombre            String    @db.VarChar(200)
  estado            String    @default("pendiente") @db.VarChar(20)
  solicitadoPor     String?
  aprobadoPor       String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  empleado          empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  festivoEmpresa    festivos  @relation(fields: [festivoEmpresaId], references: [id], onDelete: Cascade)

  @@unique([empleadoId, festivoEmpresaId])
  @@index([empleadoId])
  @@index([estado])
  @@index([festivoEmpresaId])
}

model fichaje_eventos {
  id            String            @id @default(cuid())
  fichajeId     String
  hora          DateTime          @db.Timestamptz(6)
  ubicacion     String?
  editado       Boolean           @default(false)
  motivoEdicion String?
  horaOriginal  DateTime?         @db.Timestamptz(6)
  editadoPor    String?
  createdAt     DateTime          @default(now())
  tipo          TipoFichajeEvento
  fichaje       fichajes          @relation("eventos", fields: [fichajeId], references: [id], onDelete: Cascade)

  @@index([fichajeId, hora])
  @@index([fichajeId])
  @@index([hora])
  @@index([tipo])
}

model fichajes {
  id                             String                           @id @default(cuid())
  empresaId                      String
  empleadoId                     String
  jornadaId                      String?
  fecha                          DateTime                         @db.Date
  autoCompletado                 Boolean                          @default(false)
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime                         @updatedAt
  fechaAprobacion                DateTime?
  horasEnPausa                   Decimal?                         @db.Decimal(5, 2)
  horasTrabajadas                Decimal?                         @db.Decimal(5, 2)
  cuadradoMasivamente            Boolean                          @default(false)
  cuadradoPor                    String?
  cuadradoEn                     DateTime?
  estado                         EstadoFichaje                    @default(en_curso)
  eventos                        fichaje_eventos[]                @relation("eventos")
  empleado                       empleados                        @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa                        empresas                         @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  jornada                        jornadas?                        @relation(fields: [jornadaId], references: [id])
  solicitudes_correccion_fichaje solicitudes_correccion_fichaje[]

  @@unique([empleadoId, fecha])
  @@index([empleadoId])
  @@index([empleadoId, jornadaId, estado, fecha])
  @@index([empresaId, empleadoId, fecha])
  @@index([empresaId, estado])
  @@index([empresaId, fecha])
  @@index([empresaId])
  @@index([estado])
  @@index([fecha])
}

model firmas {
  id                String            @id @default(cuid())
  solicitudFirmaId  String
  empleadoId        String
  estado            String            @default("pendiente") @db.VarChar(50)
  enviadoEn         DateTime?
  firmadoEn         DateTime?
  rechazadoEn       DateTime?
  ipAddress         String?           @db.VarChar(50)
  userAgent         String?
  ubicacion         Json?
  certificado       String?
  metodoFirma       String?           @db.VarChar(50)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  certificadoHash   String?
  datosCapturados   Json?
  firmado           Boolean           @default(false)
  metodoCaptura     String            @default("click") @db.VarChar(50)
  numRecordatorios  Int               @default(0)
  orden             Int               @default(0)
  tipo              String            @default("simple") @db.VarChar(50)
  empleado          empleados         @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  solicitudes_firma solicitudes_firma @relation(fields: [solicitudFirmaId], references: [id], onDelete: Cascade)

  @@unique([solicitudFirmaId, empleadoId])
  @@index([empleadoId, firmado])
  @@index([empleadoId])
  @@index([enviadoEn])
  @@index([estado])
  @@index([firmadoEn])
  @@index([firmado])
  @@index([solicitudFirmaId, firmado])
  @@index([solicitudFirmaId])
}

model integraciones {
  id         String   @id @default(cuid())
  empresaId  String
  tipo       String   @db.VarChar(50)
  proveedor  String   @db.VarChar(100)
  config     Json?
  activa     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  calendarId String?  @db.VarChar(255)
  usuarioId  String?
  empresa    empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, tipo, proveedor, usuarioId])
  @@index([empresaId])
  @@index([tipo])
  @@index([usuarioId])
}

model invitaciones_empleados {
  id         String    @id @default(cuid())
  empresaId  String
  empleadoId String    @unique
  email      String
  token      String    @unique
  expiraEn   DateTime
  aceptada   Boolean   @default(false)
  createdAt  DateTime  @default(now())
  empleado   empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa    empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([empresaId])
  @@index([token])
}

model invitaciones_signup {
  id          String    @id @default(cuid())
  email       String    @unique
  token       String    @unique
  expiraEn    DateTime
  usada       Boolean   @default(false)
  usadoEn     DateTime?
  invitadoPor String?
  createdAt   DateTime  @default(now())

  @@index([email])
  @@index([token])
  @@index([usada])
}

model jobs_generacion_documentos {
  id                    String                @id @default(cuid())
  empresaId             String
  plantillaId           String
  solicitadoPor         String
  empleadoIds           Json
  configuracion         Json
  estado                String                @default("en_cola") @db.VarChar(50)
  progreso              Int                   @default(0) @db.SmallInt
  totalEmpleados        Int
  procesados            Int                   @default(0)
  exitosos              Int                   @default(0)
  fallidos              Int                   @default(0)
  iniciadoEn            DateTime?
  completadoEn          DateTime?
  tiempoTotal           Int?
  resultados            Json?
  error                 String?
  intentos              Int                   @default(0) @db.SmallInt
  ultimoIntento         DateTime?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  empresa               empresas              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  plantillas_documentos plantillas_documentos @relation(fields: [plantillaId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([empresaId])
  @@index([estado])
  @@index([plantillaId])
  @@index([solicitadoPor])
}

/// Jornada - Work schedule templates
/// Defines expected work hours and working days (e.g., "40h flexible")
/// Note: Time limits (limiteInferior/Superior) are now global per company in Empresa.config
/// Note: 'nombre' field has been removed - generate descriptive names in UI based on config
model jornadas {
  id             String      @id @default(cuid())
  empresaId      String
  horasSemanales Decimal     @db.Decimal(5, 2) // e.g., 40.00 hours

  // Schedule config (JSONB for flexibility)
  // Example fija: { "tipo": "fija", "lunes": { "activo": true, "entrada": "09:00", "salida": "18:00", "pausa_inicio": "14:00", "pausa_fin": "15:00" }, ... }
  // Example flexible: { "tipo": "flexible", "descansoMinimo": "00:30", "lunes": { "activo": true }, ... }
  // NOTE: limiteInferior and limiteSuperior are NO LONGER stored here - they are global in Empresa.config
  config         Json

  // Predefined by system (cannot be deleted)
  esPredefinida  Boolean     @default(false)
  activa         Boolean     @default(true)

  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  empleados      empleados[]
  fichajes       fichajes[]
  empresa        empresas    @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
}

model nominas {
  id                     String                     @id @default(cuid())
  empleadoId             String
  mes                    Int                        @db.SmallInt
  anio                   Int                        @db.SmallInt
  documentoId            String?                    @unique
  datosExtraidosIA       Json?
  verificado             Boolean                    @default(false)
  tieneAnomalias         Boolean                    @default(false)
  createdAt              DateTime                   @default(now())
  updatedAt              DateTime                   @updatedAt
  empleadoNotificado     Boolean                    @default(false)
  empleadoVisto          Boolean                    @default(false)
  estado                 String                     @default("pendiente") @db.VarChar(50)
  fechaNotificacion      DateTime?
  fechaPublicacion       DateTime?
  fechaVisto             DateTime?
  subidoPor              String?
  complementosPendientes Boolean                    @default(false)
  contratoId             String?
  diasAusencias          Int                        @default(0) @db.SmallInt
  diasTrabajados         Int                        @default(0) @db.SmallInt
  eventoNominaId         String?
  exportadaEn            DateTime?
  salarioBase            Decimal                    @db.Decimal(10, 2)
  totalBruto             Decimal                    @db.Decimal(10, 2)
  totalComplementos      Decimal                    @default(0) @db.Decimal(10, 2)
  totalDeducciones       Decimal                    @default(0) @db.Decimal(10, 2)
  totalNeto              Decimal                    @db.Decimal(10, 2)
  alertas                alertas_nomina[]
  complementosAsignados  asignaciones_complemento[]
  contrato               contratos?                 @relation(fields: [contratoId], references: [id])
  documento              documentos?                @relation(fields: [documentoId], references: [id])
  empleado               empleados                  @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  eventoNomina           eventos_nomina?            @relation(fields: [eventoNominaId], references: [id])

  @@unique([empleadoId, mes, anio])
  @@index([contratoId])
  @@index([documentoId])
  @@index([empleadoId, estado])
  @@index([empleadoId])
  @@index([estado])
  @@index([eventoNominaId, estado])
  @@index([eventoNominaId])
  @@index([mes, anio])
}

model notificaciones {
  id             String          @id @default(cuid())
  empresaId      String
  usuarioId      String
  tipo           String          @db.VarChar(50)
  mensaje        String          @db.Text
  metadata       Json?
  leida          Boolean         @default(false)
  createdAt      DateTime        @default(now())
  eventoNominaId String?
  empresa        empresas        @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  eventos_nomina eventos_nomina? @relation(fields: [eventoNominaId], references: [id])
  usuario        usuarios        @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([empresaId])
  @@index([eventoNominaId])
  @@index([usuarioId, leida])
}

model onboarding_configs {
  id                   String   @id @default(cuid())
  empresaId            String   @unique
  camposRequeridos     Json     @default("{\"datos_bancarios\": {\"bic\": true, \"iban\": true}, \"datos_personales\": {\"nif\": true, \"nss\": true, \"ciudad\": true, \"telefono\": true, \"estadoCivil\": false, \"numeroHijos\": false, \"codigoPostal\": true, \"direccionPiso\": false, \"direccionCalle\": true, \"direccionNumero\": true, \"direccionProvincia\": true}}")
  documentosRequeridos Json     @default("[]")
  plantillasDocumentos Json     @default("[]")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  empresa              empresas @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
}

model onboarding_empleados {
  id              String    @id @default(cuid())
  empresaId       String
  empleadoId      String    @unique
  token           String    @unique
  tokenExpira     DateTime
  completado      Boolean   @default(false)
  fechaCompletado DateTime?
  progreso        Json      @default("{\"datos_bancarios\": false, \"datos_documentos\": false, \"datos_personales\": false, \"credenciales_completadas\": false}")
  datosTemporales Json?
  createdAt       DateTime  @default(now())
  tipoOnboarding  String    @default("completo") @db.VarChar(20)
  empleado        empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa         empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empleadoId])
  @@index([empresaId])
  @@index([token])
}

model plantillas_documentos {
  id                         String                       @id @default(cuid())
  empresaId                  String?
  nombre                     String                       @db.VarChar(255)
  descripcion                String?
  categoria                  String                       @db.VarChar(100)
  tipo                       String                       @db.VarChar(50)
  formato                    String                       @db.VarChar(20)
  s3Key                      String                       @unique
  s3Bucket                   String                       @db.VarChar(255)
  variablesUsadas            Json                         @default("[]")
  activa                     Boolean                      @default(true)
  esOficial                  Boolean                      @default(false)
  requiereContrato           Boolean                      @default(false)
  requiereFirma              Boolean                      @default(false)
  carpetaDestinoDefault      String?                      @db.VarChar(50)
  usarIAParaExtraer          Boolean                      @default(false)
  configuracionIA            Json?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  autoGenerarOffboarding     Boolean                      @default(false)
  autoGenerarOnboarding      Boolean                      @default(false)
  permiteRellenar            Boolean                      @default(false)
  requiereRevision           Boolean                      @default(false)
  documentosGenerados        documentosGenerado[]
  jobs_generacion_documentos jobs_generacion_documentos[]
  empresas                   empresas?                    @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([activa])
  @@index([categoria])
  @@index([empresaId])
  @@index([esOficial])
  @@index([tipo])
}

model preferencias_vacaciones {
  id                 String              @id @default(cuid())
  campanaId          String
  empleadoId         String
  empresaId          String
  diasIdeales        Json
  diasPrioritarios   Json?
  diasAlternativos   Json?
  completada         Boolean             @default(false)
  aceptada           Boolean             @default(false)
  propuestaIA        Json?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  propuestaEnviada   Boolean             @default(false)
  cambioSolicitado   Boolean             @default(false)
  propuestaEmpleado  Json?
  campana_vacaciones campanas_vacaciones @relation(fields: [campanaId], references: [id], onDelete: Cascade)
  empleado           empleados           @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa            empresas            @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([campanaId, empleadoId])
  @@index([campanaId])
  @@index([completada])
  @@index([empleadoId])
  @@index([empresaId])
}

model puestos {
  id          String       @id @default(cuid())
  empresaId   String
  nombre      String       @db.VarChar(100)
  descripcion String?
  activo      Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  documentos  documentos[]
  empleados   empleados[]
  empresa     empresas     @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, nombre])
  @@index([empresaId])
}

model resumenes_mensuales_nomina {
  id                        String    @id @default(cuid())
  empresaId                 String
  empleadoId                String
  mes                       Int       @db.SmallInt
  anio                      Int       @db.SmallInt
  diasLaborables            Int       @default(0)
  diasTrabajados            Int       @default(0)
  diasVacaciones            Int       @default(0)
  diasBajaIT                Int       @default(0)
  diasPermisosRetribuidos   Int       @default(0)
  diasPermisosNoRetribuidos Int       @default(0)
  horasTrabajadas           Decimal   @default(0) @db.Decimal(10, 2)
  horasExtras               Decimal   @default(0) @db.Decimal(10, 2)
  salarioBase               Decimal?  @db.Decimal(10, 2)
  calculadoEn               DateTime  @default(now())
  empleado                  empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa                   empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, empleadoId, mes, anio])
  @@index([empleadoId])
  @@index([empresaId, anio, mes])
}

model sedes {
  id        String    @id @default(cuid())
  empresaId String
  nombre    String    @db.VarChar(200)
  ciudad    String    @db.VarChar(100)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  activo    Boolean   @default(true)
  equipos   equipos[]
  empresa   empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
}

model sesiones_activas {
  id        String   @id @default(cuid())
  usuarioId String
  tokenHash String   @unique
  ipAddress String?  @db.VarChar(50)
  userAgent String?
  createdAt DateTime @default(now())
  ultimoUso DateTime @default(now())
  expiraEn  DateTime
  usuario   usuarios @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([expiraEn])
  @@index([tokenHash])
  @@index([usuarioId])
}

model sessions {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  usuario      usuarios @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model solicitudes_cambio {
  id                       String          @id @default(cuid())
  empresaId                String
  empleadoId               String
  aprobadorId              String?
  tipo                     String          @db.VarChar(100)
  camposCambiados          Json
  motivo                   String?
  motivoRechazo            String?
  fechaRespuesta           DateTime?
  createdAt                DateTime        @default(now())
  updatedAt                DateTime        @updatedAt
  requiereAprobacionManual Boolean         @default(false)
  revisadaPorIA            Boolean         @default(false)
  revisionIA               Json?
  estado                   EstadoSolicitud @default(pendiente)
  aprobador                empleados?      @relation("solicitudes_cambio_aprobadorIdToempleados", fields: [aprobadorId], references: [id])
  empleado                 empleados       @relation("solicitudes_cambio_empleadoIdToempleados", fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa                  empresas        @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([aprobadorId])
  @@index([empleadoId])
  @@index([empresaId, estado])
  @@index([empresaId])
  @@index([estado])
}

model solicitudes_correccion_fichaje {
  id                                                              String                           @id @default(cuid())
  empresaId                                                       String
  fichajeId                                                       String
  empleadoId                                                      String
  estado                                                          EstadoSolicitudCorreccionFichaje @default(pendiente)
  motivo                                                          String
  detalles                                                        Json
  respuesta                                                       String?
  revisadaPor                                                     String?
  revisadaEn                                                      DateTime?
  createdAt                                                       DateTime                         @default(now())
  updatedAt                                                       DateTime                         @updatedAt
  empleados_solicitudes_correccion_fichaje_empleadoIdToempleados  empleados                        @relation("solicitudes_correccion_fichaje_empleadoIdToempleados", fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa                                                         empresas                         @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  fichaje                                                         fichajes                         @relation(fields: [fichajeId], references: [id], onDelete: Cascade)
  empleados_solicitudes_correccion_fichaje_revisadaPorToempleados empleados?                       @relation("solicitudes_correccion_fichaje_revisadaPorToempleados", fields: [revisadaPor], references: [id])

  @@index([empleadoId])
  @@index([empresaId])
  @@index([estado])
  @@index([fichajeId])
  @@index([revisadaPor])
}

model solicitudes_eliminacion_datos {
  id             String    @id @default(cuid())
  empresaId      String
  empleadoId     String
  solicitantePor String
  estado         String    @default("pendiente") @db.VarChar(50)
  motivo         String?
  respuesta      String?
  completadaEn   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  empleado       empleados @relation(fields: [empleadoId], references: [id], onDelete: Cascade)
  empresa        empresas  @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empleadoId])
  @@index([empresaId])
  @@index([estado])
}

model solicitudes_firma {
  id                     String     @id @default(cuid())
  empresaId              String
  documentoId            String
  solicitadoPor          String?    @db.VarChar(100)
  solicitadoEn           DateTime?  @default(now())
  mensaje                String?
  fechaLimite            DateTime?
  estado                 String     @default("pendiente") @db.VarChar(50)
  tipo                   String     @default("individual") @db.VarChar(50)
  proveedor              String     @default("interno") @db.VarChar(50)
  completadaEn           DateTime?
  expiradaEn             DateTime?
  canceladaEn            DateTime?
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @updatedAt
  pdfFirmadoS3Key        String?
  pdfTemporalS3Key       String?
  creadoPor              String?    @db.VarChar(100)
  diasRecordatorio       Int        @default(3)
  hashDocumento          String
  motivoCancelacion      String?
  mantenerOriginal       Boolean    @default(true)
  nombreDocumento        String     @db.VarChar(255)
  ordenFirma             Boolean    @default(false)
  recordatorioAutomatico Boolean    @default(true)
  titulo                 String     @db.VarChar(255)
  posicionFirma          Json?
  firmas                 firmas[]
  documentos             documentos @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  empresa                empresas   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([documentoId])
  @@index([empresaId, createdAt])
  @@index([empresaId, estado])
  @@index([empresaId])
  @@index([estado])
  @@index([fechaLimite])
  @@index([solicitadoPor])
  @@index([tipo])
}

model subscriptions {
  id                 String             @id @default(cuid())
  empresaId          String
  customerId         String
  priceId            String
  status             SubscriptionStatus @default(active)
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  trialStart         DateTime?
  trialEnd           DateTime?
  cancelAtPeriodEnd  Boolean            @default(false)
  canceledAt         DateTime?
  metadata           Json?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  billing_customer   billing_customers  @relation(fields: [customerId], references: [id], onDelete: Cascade)
  empresa            empresas           @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  billing_prices     billing_prices     @relation(fields: [priceId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([empresaId])
  @@index([priceId])
  @@index([status])
}

model tipos_complemento {
  id                    String                  @id @default(cuid())
  empresaId             String
  nombre                String                  @db.VarChar(200)
  descripcion           String?
  activo                Boolean                 @default(true)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  empleado_complementos empleado_complementos[]
  empresa               empresas                @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId, activo])
}

model usuarios {
  id                String              @id @default(cuid())
  empresaId         String
  empleadoId        String?             @unique
  email             String              @unique @db.VarChar(255)
  cognitoId         String?             @unique @db.VarChar(255)
  nombre            String              @db.VarChar(100)
  apellidos         String              @db.VarChar(200)
  avatar            String?
  activo            Boolean             @default(true)
  emailVerificado   Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  ultimoAcceso      DateTime?
  password          String?             @db.VarChar(255)
  googleId          String?             @unique @db.VarChar(255)
  rol               UsuarioRol          @default(empleado)
  backupCodes       Json?
  totpEnabled       Boolean             @default(false)
  totpEnabledAt     DateTime?
  totpSecret        String?
  accounts          accounts[]
  auditoria_accesos auditoria_accesos[]
  empleado          empleados?
  notificaciones    notificaciones[]
  sesiones_activas  sesiones_activas[]
  sessions          sessions[]
  empresa           empresas            @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([cognitoId])
  @@index([email])
  @@index([empresaId])
  @@index([googleId])
}

model variable_mappings {
  id                 String   @id @default(cuid())
  variableName       String   @unique @db.VarChar(200)
  jsonPath           String
  requiresDecryption Boolean  @default(false)
  requiresFormatting Boolean  @default(false)
  formatType         String?  @db.VarChar(50)
  formatPattern      String?  @db.VarChar(100)
  generadoPorIA      Boolean  @default(true)
  confianza          Decimal  @db.Decimal(3, 2)
  verificado         Boolean  @default(false)
  vecesUsado         Int      @default(0)
  ultimoUso          DateTime @default(now())
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([ultimoUso])
  @@index([variableName])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model waitlist {
  id         String    @id @default(cuid())
  email      String    @unique
  nombre     String?   @db.VarChar(200)
  empresa    String?   @db.VarChar(200)
  mensaje    String?
  invitado   Boolean   @default(false)
  invitadoEn DateTime?
  createdAt  DateTime  @default(now())

  @@index([email])
  @@index([invitado])
}

enum BillingInterval {
  month
  year
}

enum EstadoAusencia {
  pendiente
  confirmada
  completada
  rechazada
}

enum EstadoEmpleado {
  activo
  baja
  suspendido
}

enum EstadoFichaje {
  en_curso
  pendiente
  finalizado
}

enum EstadoSolicitud {
  pendiente
  requiere_revision
  auto_aprobada
  aprobada_manual
  rechazada
}

enum EstadoSolicitudCorreccionFichaje {
  pendiente
  aprobada
  rechazada
}

enum PeriodoMedioDia {
  manana
  tarde
}

enum SubscriptionStatus {
  trialing
  active
  canceled
  incomplete
  incomplete_expired
  past_due
  unpaid
  paused
}

enum TipoAusencia {
  vacaciones
  enfermedad
  enfermedad_familiar
  maternidad_paternidad
  otro
}

enum TipoContrato {
  indefinido
  temporal
  administrador
  fijo_discontinuo
  becario
  practicas
  obra_y_servicio
}

enum TipoEquipo {
  proyecto
  squad
  temporal
}

enum TipoFichajeEvento {
  entrada
  pausa_inicio
  pausa_fin
  salida
}

enum UsuarioRol {
  platform_admin
  hr_admin
  manager
  empleado
}
