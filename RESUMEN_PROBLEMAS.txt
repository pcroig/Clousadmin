â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RESUMEN EJECUTIVO - VERIFICACIÃ“N lib/utils/fechas.ts
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CRÃTICO: 1 | IMPORTANTE: 3 | ADVERTENCIA: 5 | OK: 15

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”´ CRÃTICO (Debe repararse inmediatamente)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[C1] Array duplicado 'miercoles' â†’ martes se ignora
   Archivo: /home/user/Clousadmin/app/api/fichajes/revision/route.ts
   LÃ­nea: 221
   Problema: ['domingo', 'lunes', 'miercoles','miercoles','jueves','viernes','sabado']
             Ãndice 2 devuelve 'miercoles' en lugar de 'martes'
   Impacto: Los fichajes de martes se procesan con config de miÃ©rcoles
   Fix: Reemplazar por ['domingo','lunes','martes','miercoles','jueves','viernes','sabado']

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âš ï¸ IMPORTANTE (Mejoras antes de producciÃ³n)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[I1] FunciÃ³n calcularDiasEntre produce off-by-one con horas
   Archivo: /home/user/Clousadmin/lib/utils/fechas.ts
   LÃ­nea: 158-166
   Problema: Math.ceil(5.166) + 1 = 7 dÃ­as (deberÃ­a ser 6)
   Causa: No normaliza fechas antes de calcular
   SoluciÃ³n: Normalizar ambas fechas a inicio de dÃ­a primero
   Fix recomendado:
     const inicioNormalizado = normalizarFecha(inicio);
     const finNormalizado = normalizarFecha(fin);
     const ms = Math.abs(finNormalizado.getTime() - inicioNormalizado.getTime());
     const dias = Math.floor(ms / (1000 * 60 * 60 * 24));
     return incluirAmbos ? dias + 1 : dias;

[I2] Funciones de validaciÃ³n sin check de null/undefined
   Archivo: /home/user/Clousadmin/lib/utils/fechas.ts
   LÃ­nea: 300-314
   Funciones: esFechaPasada(), esFechaFutura(), esMismoDia()
   Problema: Lanzan error si reciben null en lugar de retornar false
   SoluciÃ³n: AÃ±adir validaciÃ³n inicial
   Ejemplo:
     export function esFechaPasada(fecha: Date | null | undefined): boolean {
       if (!fecha || !(fecha instanceof Date)) return false;
       return fecha < new Date();
     }

[I3] DuplicaciÃ³n de funciÃ³n formatearFechaRelativa
   Archivos: 
     - /home/user/Clousadmin/lib/utils/fechas.ts (lÃ­nea 243-262)
     - /home/user/Clousadmin/lib/utils/formatters.ts (lÃ­nea 238-257)
   Problema: Dos implementaciones idÃ©nticas
   SoluciÃ³n: Usar solo la de fechas.ts, deprecar la de formatters.ts

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“‹ CONFLICTOS (Inconsistencias con cÃ³digo existente)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[CF1] Formato de fecha largo usa 'd' vs 'dd'
   Helper nuevo: "1 de enero de 2025" (sin padding)
   Plantillas existentes: "01 de enero de 2025" (con padding)
   UbicaciÃ³n: /home/user/Clousadmin/lib/plantillas/sanitizar.ts:48 vs fechas.ts:195
   RecomendaciÃ³n: Unificar usando 'd' (mÃ¡s natural en espaÃ±ol)

[CF2] DuplicaciÃ³n de normalizarFecha en tres lugares
   - /home/user/Clousadmin/lib/utils/fechas.ts:94 (nuevo)
   - /home/user/Clousadmin/lib/calculos/plantilla.ts:25 (existente)
   - /home/user/Clousadmin/lib/utils/fichajesHistorial.ts:117 (existente, diferente)
   SoluciÃ³n: Centralizar en fechas.ts

[CF3] DIAS_SEMANA sin tildes ('miercoles', 'sabado')
   Causa: Compatibilidad con cÃ³digo existente (18 archivos usan mismo formato)
   DecisiÃ³n: MANTENER sin cambios para compatibilidad

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âš ï¸ ADVERTENCIAS (Comportamiento a documentar)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[A1] Funciones operan en timezone LOCAL, no UTC
   Afectadas: obtenerNombreDia, normalizarFecha, obtenerFechaBase, esMismoDia
   Riesgo: Si se usan con fechas UTC, pueden cambiar de dÃ­a
   DocumentaciÃ³n: AÃ±adir nota en JSDoc sobre timezone local

[A2] DIAS_SEMANA: domingo = 0 (compatibilidad con getDay())
   VerificaciÃ³n: âœ… Correcto - coincide con JavaScript getDay()
   Orden correcto: domingo(0), lunes(1), martes(2), miÃ©rcoles(3), etc.

[A3] date-fns ya estÃ¡ en el proyecto
   VerificaciÃ³n: âœ… Compatible - mismo package, mismos imports
   VersiÃ³n: (verificar en package.json)

[A4] VerificaciÃ³n de fechas vÃ¡lidas funciona correctamente
   FunciÃ³n: esFechaValida()
   VerificaciÃ³n: âœ… Implementada correctamente con instanceof y isNaN()

[A5] CÃ¡lculo de diferencias en horas y minutos es correcto
   Funciones: calcularHorasEntre(), calcularMinutosEntre()
   FÃ³rmula: (fin - inicio) / (1000 * 60 * 60) o (1000 * 60)
   VerificaciÃ³n: âœ… Coincide con usos existentes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ… VERIFICACIONES PASADAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[V1] orden de DIAS_SEMANA coincide con getDay()
   - getDay() devuelve 0-6 donde 0 = domingo âœ…
   - DIAS_SEMANA estÃ¡ en el mismo orden âœ…
   - 18 archivos usan la funciÃ³n obtenerNombreDia correctamente âœ…

[V2] Formateo date-fns compatible
   - format() disponible âœ…
   - locale 'es' disponible âœ…
   - Patterns correctos âœ…

[V3] Funciones de manipulaciÃ³n (agregarDias, agregarMeses, etc.)
   - agregarDias: âœ… Correcto
   - agregarMeses: âœ… Correcto
   - obtenerPrimerDiaMes: âœ… Correcto
   - obtenerUltimoDiaMes: âœ… Correcto

[V4] Edge cases base
   - Fechas sin horas: âœ… Funcionan
   - Fechas con horas: âœ… Funcionan
   - Mismo dÃ­a: âœ… Funciona
   - AÃ±os bisiestos: âœ… Manejados por Date nativo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PLAN DE ACCIÃ“N RECOMENDADO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

INMEDIATO (Hoy):
  [ ] Reparar array 'miercoles' duplicado en revision/route.ts:221
      git commit -m "fix: corregir array de dÃ­as con martes duplicado"

ANTES DE USAR HELPERS (Esta semana):
  [ ] Mejorar calcularDiasEntre con normalizaciÃ³n
  [ ] AÃ±adir validaciÃ³n null/undefined a funciones de validaciÃ³n
  [ ] Consolidar normalizarFecha en un solo lugar
  [ ] Escribir tests unitarios para edge cases

OPCIONAL (PrÃ³ximas semanas):
  [ ] Unificar formato de fecha largo (d vs dd)
  [ ] Documentar timezone local en JSDoc
  [ ] Crear helper para UTC si es necesario

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
